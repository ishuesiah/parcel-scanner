{% extends "base.html" %}

{% block title %}All Batches - H&O Parcel Scans{% endblock %}

{% block extra_styles %}{% endblock %}

{% block content %}
    <!-- Active Batches Section -->
    <div class="active-batches-section">
      <h2>
        Active Batches
        {% if active_batches %}
          <span class="active-badge">{{ active_batches|length }}</span>
        {% endif %}
      </h2>

      {% if active_batches %}
        {% for b in active_batches %}
          <div class="active-batch-card">
            <div class="batch-card-info" style="flex: 1;">
              <h3>
                <a href="{{ url_for('edit_batch', batch_id=b.id) }}" title="Click to resume scanning">
                  Batch #{{ b.id }}
                </a>
              </h3>
              <div class="batch-card-meta">
                <span>{{ b.carrier }}</span>
                <span>{{ b.pkg_count }} packages</span>
                <span>{{ b.created_at|friendly_date }}</span>
                {% if b.notes %}
                  <span style="color: #534bc4;">{{ b.notes }}</span>
                {% endif %}
              </div>
            </div>
            <div class="batch-card-actions">
              <a href="{{ url_for('edit_batch', batch_id=b.id) }}" class="btn-resume">
                Resume
              </a>
              <button type="button" class="btn-delete-small"
                      onclick="if(confirm('Are you sure you want to delete batch #{{ b.id }}? This will remove all associated scans.')) { deleteBatch({{ b.id }}); }">
                Delete
              </button>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">üì¶</div>
          <h3>No active batches currently</h3>
          <a href="{{ url_for('new_batch') }}" class="btn-create-batch">
            + Create New Batch
          </a>
        </div>
      {% endif %}
    </div>

    <!-- Completed Batches Section -->
    <div class="completed-batches-section">
      <h2>Completed Batches</h2>
      {% if completed_batches %}
        <table>
          <thead>
            <tr>
              <th>Batch ID</th>
              <th>Carrier</th>
              <th>Created At</th>
              <th>Pkg Count</th>
              <th>Status</th>
              <th>Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for b in completed_batches %}
              <tr>
                <td>
                  <a class="batch-link" href="{{ url_for('edit_batch', batch_id=b.id) }}">
                    Batch {{ b.id }}
                  </a>
                </td>
                <td>{{ b.carrier }}</td>
                <td>{{ b.created_at|friendly_date }}</td>
                <td>{{ b.pkg_count }}</td>
                <td>
                  {% set batch_status = b.get('status', 'in_progress') %}
                  {% if batch_status == 'notified' %}
                    <span style="color: #199b76; font-weight: 500;">‚úâ Notified</span>
                  {% elif batch_status == 'recorded' %}
                    <span style="color: #f39c12; font-weight: 500;">‚úì Picked Up</span>
                  {% else %}
                    <span style="color: #666;">‚è≥ In Progress</span>
                  {% endif %}
                </td>
                <td>{{ b.notes or '‚Äî' }}</td>
                <td>
                  <a href="{{ url_for('edit_batch', batch_id=b.id) }}" style="color: #2d85f8; text-decoration: none; margin-right: 12px;">Edit</a>
                  <form action="{{ url_for('delete_batch') }}" method="post" style="display: inline;"
                        onsubmit="return confirm('Are you sure you want to delete batch #{{ b.id }}? This will remove all associated scans.');">
                    <input type="hidden" name="batch_id" value="{{ b.id }}">
                    <button type="submit" class="btn-delete-small">Delete</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p style="color: #999; padding: 20px 0;">No completed batches yet.</p>
      {% endif %}
    </div>

    <!-- Hidden form for delete -->
    <form id="deleteForm" action="{{ url_for('delete_batch') }}" method="post" style="display: none;">
      <input type="hidden" name="batch_id" id="deleteBatchId">
    </form>
{% endblock %}

{% block scripts %}
<script>
  function deleteBatch(batchId) {
    document.getElementById('deleteBatchId').value = batchId;
    document.getElementById('deleteForm').submit();
  }
</script>
{% endblock %}
