{% extends "base.html" %}

{% block title %}ShipStation Batches - H&O Parcel Scans{% endblock %}

{% block extra_styles %}
    .status-filters { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
    .filter-btn {
      padding: 8px 16px; border-radius: 4px; text-decoration: none;
      font-size: 0.9rem; font-weight: 500; border: 1px solid #ddd;
      background: white; color: #333;
    }
    .filter-btn:hover { background: #f0f0f0; }
    .filter-btn.active { background: #534bc4; color: white; border-color: #534bc4; }

    .batch-link { color: #534bc4; text-decoration: none; font-weight: 600; }
    .batch-link:hover { text-decoration: underline; }

    .status-badge {
      display: inline-block; padding: 4px 8px; border-radius: 4px;
      font-size: 0.85rem; font-weight: 500;
    }
    .status-completed { background-color: #e0f7e9; color: #199b76; }
    .status-processing { background-color: #fff4e5; color: #8a6100; }
    .status-open { background-color: #e3f2fd; color: #1976d2; }
    .status-queued { background-color: #f3e5f5; color: #7b1fa2; }
    .status-invalid { background-color: #fdecea; color: #952746; }
    .status-completed_with_errors { background-color: #fff3cd; color: #856404; }
    .status-archived { background-color: #f5f5f5; color: #666; }

    .pagination { margin-top: 16px; display: flex; gap: 8px; align-items: center; }
    .pagination a {
      padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px;
      text-decoration: none; color: #534bc4; background: white;
    }
    .pagination a:hover { background: #f0f0f0; }
    .pagination span { color: #666; font-size: 0.9rem; }
{% endblock %}

{% block content %}
    <h2>ShipStation Batches</h2>

    <div class="status-filters">
      <a href="{{ url_for('ss_batches', status='completed') }}" class="filter-btn {{ 'active' if current_status == 'completed' else '' }}">Completed</a>
      <a href="{{ url_for('ss_batches', status='processing') }}" class="filter-btn {{ 'active' if current_status == 'processing' else '' }}">Processing</a>
      <a href="{{ url_for('ss_batches', status='open') }}" class="filter-btn {{ 'active' if current_status == 'open' else '' }}">Open</a>
      <a href="{{ url_for('ss_batches', status='queued') }}" class="filter-btn {{ 'active' if current_status == 'queued' else '' }}">Queued</a>
      <a href="{{ url_for('ss_batches', status='completed_with_errors') }}" class="filter-btn {{ 'active' if current_status == 'completed_with_errors' else '' }}">With Errors</a>
    </div>

    {% if error %}
      <div class="flash error">{{ error }}</div>
    {% endif %}

    {% if batches %}
      <table>
        <thead>
          <tr>
            <th>Batch ID</th>
            <th>Notes</th>
            <th>Created</th>
            <th>Count</th>
            <th>Status</th>
            <th>Errors</th>
          </tr>
        </thead>
        <tbody>
          {% for b in batches %}
            <tr>
              <td><a class="batch-link" href="{{ url_for('ss_batch_detail', batch_id=b.batch_id) }}">{{ b.batch_id }}</a></td>
              <td>{{ b.batch_notes or '-' }}</td>
              <td>{{ b.created_at[:16] if b.created_at else '-' }}</td>
              <td>{{ b.count }}</td>
              <td><span class="status-badge status-{{ b.status }}">{{ b.status }}</span></td>
              <td>{{ b.errors or 0 }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="pagination">
        {% if page > 1 %}
          <a href="{{ url_for('ss_batches', status=current_status, page=page-1) }}">&larr; Prev</a>
        {% endif %}
        <span>Page {{ page }} of {{ pages }}</span>
        {% if page < pages %}
          <a href="{{ url_for('ss_batches', status=current_status, page=page+1) }}">Next &rarr;</a>
        {% endif %}
      </div>
    {% else %}
      <p style="color: #666; margin-top: 20px;">No batches found with status "{{ current_status }}".</p>
    {% endif %}
{% endblock %}
