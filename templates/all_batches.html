{% extends "base.html" %}

{% block title %}All Batches - H&O Parcel Scans{% endblock %}

{% block extra_styles %}
<style>
  /* Batch card hover actions - hidden by default, shown on hover */
  .batch-card-actions {
    opacity: 0;
    transition: opacity 0.2s ease;
  }
  .batch-card:hover .batch-card-actions,
  .active-batch-card:hover .batch-card-actions {
    opacity: 1;
  }

  /* Completed batch card styling */
  .batch-card {
    background: var(--bg-surface);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .batch-card:hover {
    background: var(--bg-main);
    border-color: var(--secondary);
    box-shadow: 0 2px 8px rgba(81, 106, 236, 0.1);
  }

  /* Status badge styling */
  .batch-status {
    font-size: 0.8rem;
    font-weight: 500;
    padding: 4px 10px;
    border-radius: 12px;
  }
  .batch-status.notified {
    background: rgba(25, 155, 118, 0.1);
    color: #199b76;
  }
  .batch-status.recorded {
    background: rgba(243, 156, 18, 0.1);
    color: #f39c12;
  }
  .batch-status.in-progress {
    background: var(--bg-main);
    color: var(--text-muted);
  }
</style>
{% endblock %}

{% block content %}
    <!-- Active Batches Section -->
    <div class="active-batches-section">
      <h2>
        Active Batches
        {% if active_batches %}
          <span class="active-badge">{{ active_batches|length }}</span>
        {% endif %}
      </h2>

      {% if active_batches %}
        {% for b in active_batches %}
          <div class="active-batch-card" onclick="window.location.href='{{ url_for('edit_batch', batch_id=b.id) }}'">
            <div class="batch-card-info" style="flex: 1;">
              <h3>
                <a href="{{ url_for('edit_batch', batch_id=b.id) }}" title="Click to resume scanning" onclick="event.stopPropagation();">
                  Batch #{{ b.id }}
                </a>
              </h3>
              <div class="batch-card-meta">
                <span>{{ b.carrier }}</span>
                <span>{{ b.pkg_count }} packages</span>
                <span>{{ b.created_at|friendly_date }}</span>
                {% if b.notes %}
                  <span style="color: var(--secondary);">{{ b.notes }}</span>
                {% endif %}
              </div>
            </div>
            <div class="batch-card-actions" onclick="event.stopPropagation();">
              <a href="{{ url_for('edit_batch', batch_id=b.id) }}" class="btn-resume">Resume</a>
              <button type="button" class="btn-delete-small"
                      onclick="if(confirm('Delete batch #{{ b.id }}? This removes all scans.')) deleteBatch({{ b.id }});">
                Delete
              </button>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">üì¶</div>
          <h3>No active batches currently</h3>
          <a href="{{ url_for('new_batch') }}" class="btn-create-batch">
            + Create New Batch
          </a>
        </div>
      {% endif %}
    </div>

    <!-- Completed Batches Section -->
    <div class="completed-batches-section">
      <h2>Completed Batches</h2>
      {% if completed_batches %}
        {% for b in completed_batches %}
          {% set batch_status = b.get('status', 'in_progress') %}
          <div class="batch-card" onclick="window.location.href='{{ url_for('edit_batch', batch_id=b.id) }}'">
            <div class="batch-card-info" style="flex: 1;">
              <h3 style="margin: 0 0 6px 0;">
                <a href="{{ url_for('edit_batch', batch_id=b.id) }}" onclick="event.stopPropagation();" style="color: var(--text-main); text-decoration: none;">
                  Batch #{{ b.id }}
                </a>
              </h3>
              <div class="batch-card-meta">
                <span>{{ b.carrier }}</span>
                <span>{{ b.pkg_count }} packages</span>
                <span>{{ b.created_at|friendly_date }}</span>
                {% if batch_status == 'notified' %}
                  <span class="batch-status notified">‚úâ Notified</span>
                {% elif batch_status == 'recorded' %}
                  <span class="batch-status recorded">‚úì Picked Up</span>
                {% else %}
                  <span class="batch-status in-progress">‚è≥ In Progress</span>
                {% endif %}
                {% if b.notes %}
                  <span style="color: var(--secondary);">{{ b.notes }}</span>
                {% endif %}
              </div>
            </div>
            <div class="batch-card-actions" onclick="event.stopPropagation();">
              <a href="{{ url_for('edit_batch', batch_id=b.id) }}" class="btn-resume">Edit</a>
              <button type="button" class="btn-delete-small"
                      onclick="if(confirm('Delete batch #{{ b.id }}? This removes all scans.')) deleteBatch({{ b.id }});">
                Delete
              </button>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p style="color: var(--text-muted); padding: 20px 0;">No completed batches yet.</p>
      {% endif %}
    </div>

    <!-- Hidden form for delete -->
    <form id="deleteForm" action="{{ url_for('delete_batch') }}" method="post" style="display: none;">
      <input type="hidden" name="batch_id" id="deleteBatchId">
    </form>
{% endblock %}

{% block scripts %}
<script>
  function deleteBatch(batchId) {
    document.getElementById('deleteBatchId').value = batchId;
    document.getElementById('deleteForm').submit();
  }
</script>
{% endblock %}
